---
import Layout from '../../layouts/Layout.astro';
import { Button } from '@thamimagi/design-system';
import { getArticles, getArticleBySlug } from '../../lib/directus';

export async function getStaticPaths() {
  const articles = await getArticles();
  return articles.map((article) => ({
    params: { slug: article.slug },
  }));
}

const { slug } = Astro.params;
const article = await getArticleBySlug(slug!);

if (!article) {
  return Astro.redirect('/posts');
}
---

<Layout title={`${article.title} | Blog`}>
  <main class="container mx-auto px-4 py-8 max-w-3xl">
    <a href="/posts" class="inline-block mb-6">
      <Button variant="ghost" size="sm">‚Üê Back to Posts</Button>
    </a>

    <article>
      <header class="mb-8">
        <h1 class="text-4xl font-bold mb-4">{article.title}</h1>
        <p class="text-gray-500">
          {new Date(article.date_created).toLocaleDateString('en-ZA', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
          {article.date_updated && (
            <span class="ml-2">
              (Updated: {new Date(article.date_updated).toLocaleDateString('en-ZA')})
            </span>
          )}
        </p>
      </header>

      <div class="prose prose-lg max-w-none" set:html={article.content} />
    </article>
  </main>
</Layout>
